!function(r,n){"function"==typeof define&&define.amd?define("simple-uploader",["jquery","simple-module"],function(e,t){return r.returnExportsGlobal=n(e,t)}):"object"==typeof exports?module.exports=n(require("jquery"),require("simple-module")):(r.simple=r.simple||{},r.simple.uploader=n(jQuery,SimpleModule))}(this,function(a,r){var t,o={}.hasOwnProperty,n=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};return t=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,r),e.count=0,e.prototype.opts={url:"",params:null,fileKey:"upload_file",connectionCount:3},e.prototype._init=function(){return this.files=[],this.queue=[],this.id=++e.count,this.on("uploadcomplete",(r=this,function(e,t){return r.files.splice(a.inArray(t,r.files),1),0<r.queue.length&&r.files.length<r.opts.connectionCount?r.upload(r.queue.shift()):r.uploading=!1})),a(window).on("beforeunload.uploader-"+this.id,(t=this,function(e){return t.uploading?(e.originalEvent.returnValue=t._t("leaveConfirm"),t._t("leaveConfirm")):void 0}));var t,r},e.prototype.generateId=(t=0,function(){return t+=1}),e.prototype.upload=function(e,t){var r,n,o,i;if(null==t&&(t={}),null!=e){if(a.isArray(e)||e instanceof FileList)for(o=0,i=e.length;o<i;o++)r=e[o],this.upload(r,t);else a(e).is("input:file")?((n=a(e).attr("name"))&&(t.fileKey=n),this.upload(a.makeArray(a(e)[0].files),t)):e.id&&e.obj||(e=this.getFile(e));if(e&&e.obj){if(a.extend(e,t),this.files.length>=this.opts.connectionCount)return void this.queue.push(e);if(!1!==this.triggerHandler("beforeupload",[e]))return this.files.push(e),this._xhrUpload(e),this.uploading=!0}}},e.prototype.getFile=function(e){var t,r,n;return e instanceof window.File||e instanceof window.Blob?(t=null!=(r=e.fileName)?r:e.name,{id:this.generateId(),url:this.opts.url,params:this.opts.params,fileKey:this.opts.fileKey,name:t,size:null!=(n=e.fileSize)?n:e.size,ext:t?t.split(".").pop().toLowerCase():"",obj:e}):null},e.prototype._xhrUpload=function(r){var e,t,n,o,i,u,l,s;if((e=new FormData).append(r.fileKey,r.obj),e.append("original_filename",r.name),r.params)for(t in o=r.params)n=o[t],e.append(t,n);return r.xhr=a.ajax({url:r.url,data:e,processData:!1,contentType:!1,type:"POST",headers:{"X-File-Name":encodeURIComponent(r.name)},xhr:function(){var e,t;return(e=a.ajaxSettings.xhr())&&(e.upload.onprogress=(t=this,function(e){return t.progress(e)})),e},progress:(s=this,function(e){return e.lengthComputable?s.trigger("uploadprogress",[r,e.loaded,e.total]):void 0}),error:(l=this,function(e,t){return l.trigger("uploaderror",[r,e,t])}),success:(u=this,function(e){return u.trigger("uploadprogress",[r,r.size,r.size]),u.trigger("uploadsuccess",[r,e]),a(document).trigger("uploadsuccess",[r,e,u])}),complete:(i=this,function(e){return i.trigger("uploadcomplete",[r,e.responseText])})})},e.prototype.cancel=function(e){var t,r,n,o;if(!e.id)for(r=0,n=(o=this.files).length;r<n;r++)if((t=o[r]).id===1*e){e=t;break}return this.trigger("uploadcancel",[e]),e.xhr&&e.xhr.abort(),e.xhr=null},e.prototype.readImageFile=function(e,t){var r,n;if(a.isFunction(t))return(n=new Image).onload=function(){return t(n)},n.onerror=function(){return t()},window.FileReader&&FileReader.prototype.readAsDataURL&&/^image/.test(e.type)?((r=new FileReader).onload=function(e){return n.src=e.target.result},r.readAsDataURL(e)):t()},e.prototype.destroy=function(){var e,t,r,n;for(t=this.queue.length=0,r=(n=this.files).length;t<r;t++)e=n[t],this.cancel(e);return a(window).off(".uploader-"+this.id),a(document).off(".uploader-"+this.id)},e.i18n={"zh-CN":{leaveConfirm:"\u6b63\u5728\u4e0a\u4f20\u6587\u4ef6\uff0c\u5982\u679c\u79bb\u5f00\u4e0a\u4f20\u4f1a\u81ea\u52a8\u53d6\u6d88"}},e.locale="zh-CN",e;var t}(),function(e){return new t(e)}});